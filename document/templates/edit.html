{% extends 'base.html' %}

{% block title %} {{ title }} {% endblock title %}

{% block content %}

<div class=page-header>
    <h1>
        {{ title }}
    </h1>
</div>
<div class=row-fluid>
    <div class=span9>
        <div class=page-header>
            <h2>Document</h2>
        </div>
        <iframe id="iframe" width="100%" height="960" src="{% url document.views.document document.id %}">
        </iframe>
    </div>
    <div class=span3>
        <div class=page-header>
            <h2>Editor Panel</h2>
        </div>
            <ul class="nav nav-tabs nav-stacked">
                {% for section in document.sections.all %}
                    <li><a>{{ section.get_full_title }}</a></li>
                    <ul class="nav nav-tabs nav-stacked" style="margin-left:10px">
                        {% for subsection in section.subsections.all %}
                           <li><a>{{ subsection.get_full_title }}</a></li>     
                        {% endfor %}
                    </ul>
                    
                {% endfor %}
                   <li><a data-type='new_section' onclick="$('#add_section_modal').modal()"><i class=icon-plus></i> Add Section </a></li>
                   <li><a data-type='new_content'  onclick="$('#add_content_modal').modal()"><i class=icon-plus></i> Add Content </a></li>
            </ul>
    </div>
</div>

<div id=add_section_modal class="modal hide">
    <div class=modal-header>
        <button type=button class=close data-dismiss=modal onclick="$('#add_section_modal').modal('ide);"><i class=icon-remove></i></button>
        <h3>Add Section</h3>
    </div>
    <div class=modal-body>
        <div id=m_add_section_form class=controls>
            <div class=controls-row>
                <label for="m_section_parent">Parent</label>
                <select id=m_section_parent name=m_section_parent>
                    <option value='none'>Document</option>
                    {% for section in document.get_section_list %}
                        <option value={{ section.0 }}>{{ section.1 }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class=controls-row>
                <label for="m_section_title">Title</label>
                <input id=m_section_title name=m_section_title type=text>
            </div>
        </div>
    </div>
    <div class=modal-footer>
        <button class='btn btn-primary' onclick="submit_add_section()">Submit</button>
    </div>
</div>

{% endblock content %}

{% block script %}
<script>
function submit_add_section() {
    var parent = $('#m_section_parent').val();
    var title = $('#m_section_title').val();
    var type = 'new_section';
    $.ajax({
        type:'post',
        url:'{% url document.views.edit_document document.id %}',
        data:{
            'type':type,
            'parent':parent,
            'parent_id':parent,
            'title':title
        },
        success:function(){
            window.location.reload();
        }

    })
}
</script>
{% endblock script %}